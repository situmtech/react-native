parameters:
  - name: system
    type: string
  - name: XAPIEMAIL
    type: string
  - name: XAPIKEY
    type: string
  - name: BUILDINGID
    type: string
  - name: FLOORID
    type: string
  - name: DASHBOARD_URL
    type: string
steps:
  - checkout: self
    fetchDepth: 1
    fetchTags: false
    displayName: Clone repository

  - bash: |

      echo -e "\n[+] Install plugin dependencies\n"
      yarn install

      echo -e "\n[+] Install example dependencies\n"
      cd example
      yarn install

    displayName: Install plugin dependencies

  - bash: |

      export PATH="/usr/local/opt/gnu-sed/libexec/gnubin:$PATH"
      pluginVersion=$(grep version package.json | awk -F"\"" '{print $4}')
      echo "##vso[task.setvariable variable=pluginVersion]$(echo $pluginVersion)"

      echo -e "\n[+] Variables to set:"
      echo -e "\t[+] X-API-EMAIL: ${{ parameters.XAPIEMAIL }}"
      echo -e "\t[+] BUILDINGID: ${{ parameters.BUILDINGID }}"
      echo -e "\t[+] FLOORID: ${{ parameters.FLOORID }}"
      echo -e "\t[+] DASHBOARD_URL: ${{ parameters.DASHBOARD_URL }}"
      echo -e "\t[+] Plugin Version used: $pluginVersion"

      echo "export const SITUM_EMAIL = '${{ parameters.XAPIEMAIL }}';" > example/src/situm.tsx
      echo "export const SITUM_API_KEY = '${{ parameters.XAPIKEY }}';" >> example/src/situm.tsx
      echo "export const SITUM_BUILDING_ID = '${{ parameters.BUILDINGID }}';" >> example/src/situm.tsx
      echo "export const SITUM_FLOOR_ID = '${{ parameters.FLOORID }}';" >> example/src/situm.tsx
      echo "export const SITUM_DASHBOARD_URL = '${{ parameters.DASHBOARD_URL }}';"  >> example/src/situm.tsx

    displayName: Configure credentials
